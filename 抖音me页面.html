<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style>
        html,
        body {
            height: 100%;
            width: 100%;
            margin: 0;
            padding: 0;
            background: #2e3244;
        }

        .container {
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        .wrapper {
            position: relative;
            /* left: -70%; */
            /*top: -350px;*/
            display: flex;
            width: 100%;
            height: 100%;
            /* transition: all .3s; */
            /*height: 812px;*/
            /* overflow:hidden ; */

        }

        .left {
            left: 0;
            top: 0;
            position: absolute;
            height: 100%;
            width: 100%;
            background: #ccc;
            overflow-y: scroll;
        }

        .right {
            top: 0;
            left: 100%;
            position: absolute;
            height: 100%;
            width: 70%;
            background: #999;
        }

        header {
            height: 200px;
            background-image: url('./imgs/header2.jpg');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }

        .detail {
            height: 200px;
            background: #333;
        }

        .tabs-ctn {
            height: 100%;
            width: 100%;
            overflow: hidden;
        }

        .tabs {
            height: 100%;
            width: 100%;
            position: relative;
        }

        .tab {
            left: 0;
            top: 0;
            position: absolute;
            width: 100%;
            background: red;
            overflow-y: scroll;
        }

        .tab:nth-child(2) {
            left: 100%;
            background: gold;
        }

        .tab:nth-child(3) {
            left: 200%;
            background: blue;
        }

        .indicator-ctn {
            top: 0;
            left: 0;
            right: 0;
            z-index: 999;
            background: #333;
        }

        .indicator-ctn.fixed {
            position: fixed;
        }

        .indicator {
            height: 2px;
            background: gold;
            width: 30%;
            margin-left: 1.5%;
            transition: all .3s;
        }

        .tabs-text-ctn {
            height: 40px;
            display: flex;
            justify-content: space-around;
            align-items: center;
            color: gray;
        }

        .tab-text.active {
            color: white;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="wrapper">
            <div class="left">
                <header></header>
                <div class="detail"></div>
                <div class="indicator-ctn">
                    <div class="tabs-text-ctn">
                        <div class="tab-text active">作品1</div>
                        <div class="tab-text">作品1</div>
                        <div class="tab-text">作品1</div>
                    </div>
                    <div class="indicator"></div>
                </div>
                <div class="tabs-ctn">
                    <div class="tabs">
                        <div class="tab tab1">
                            <p>12</p>
                            <p>12</p>
                            <p>12</p>
                            <p>12</p>
                            <p>12</p>
                            <p>12</p>
                            <p>12</p>
                            <p>12</p>
                            <p>12</p>
                            <p>12</p>
                            <p>12</p>
                            <p>12</p>
                            <p>12</p>
                            <p>12</p>
                            <p>12</p>
                            <p>12</p>
                            <p>12</p>
                            <p>12</p>
                            <p>12</p>
                            <p>12</p>
                            <p>12</p>
                            <p>12</p>
                            <p>12</p>
                            <p>12</p>
                            <p>12</p>
                            <p>12</p>
                            <p>12</p>
                            <p>12</p>
                            <p>12</p>
                            <p>12</p>
                        </div>
                        <div class="tab tab2">
                            <p>12</p>
                            <p>12</p>
                            <p>12</p>
                            <p>12</p>
                            <p>12</p>
                            <p>12</p>
                            <p>12</p>
                            <p>12</p>
                            <p>12</p>
                        </div>
                        <div class="tab tab3">
                            <p>12</p>
                            <p>12</p>
                            <p>12</p>
                            <p>12</p>
                            <p>12</p>
                            <p>12</p>
                            <p>12</p>
                            <p>12</p>
                            <p>12</p>
                            <p>12</p>
                            <p>12</p>
                            <p>12</p>
                            <p>12</p>
                            <p>12</p>
                            <p>12</p>
                            <p>12</p>
                            <p>12</p>
                            <p>12</p>
                            <p>12</p>
                            <p>12</p>
                            <p>12</p>
                            <p>12</p>
                            <p>12</p>
                            <p>12</p>
                            <p>12</p>
                            <p>12</p>
                            <p>12</p>
                            <p>12</p>
                            <p>12</p>
                            <p>12</p>
                            <p>12</p>
                            <p>12</p>
                            <p>12</p>
                            <p>12</p>
                            <p>12</p>
                            <p>12</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="right">
                <p>111</p>
                <p>111</p>
                <p>111</p>
                <p>111</p>
            </div>
        </div>
    </div>
</body>
<script>
    !function () {
        let warpper = document.querySelector('.wrapper')
        let leftEl = document.querySelector('.left')
        let header = document.querySelector('header')
        let headerHeight = getCss(header, 'height')
        let indicatorCtn = document.querySelector('.indicator-ctn')

        let indicatorCtnOffsetTop = indicatorCtn.offsetTop
        let startLocationX = 0
        let startLocationY = 0

        let lastLocationX = 0

        let moveXDistance = 0
        let moveYDistance = 0

        let judgeValue = 20

        let startTime
        let currentSwiperItemIndex
        let isDrawRight

        let isCanRightWiping = false
        let isNeedCheck = true

        let width = document.body.clientWidth
        let rightWidth = width * 0.7

        warpper.addEventListener('touchstart', function (e) {
            warpper.style.transition = 'none'
            header.style.transition = 'none'

            let left = getCss(warpper, 'left')

            if (left !== 0) {
                currentSwiperItemIndex = 1
            } else {
                currentSwiperItemIndex = 0
            }
            startLocationX = e.touches[0].pageX
            startLocationY = e.touches[0].pageY

            startTime = Date.now()
        })
        warpper.addEventListener('touchmove', function (e) {
            lastLocationX = e.touches[0].pageX
            lastLocationY = e.touches[0].pageY
            moveXDistance = lastLocationX - startLocationX
            moveYDistance = lastLocationY - startLocationY
            checkDirection()
            if (isCanRightWiping) {
                if (currentSwiperItemIndex === 0) {
                    if (moveXDistance > 0) {
                        moveXDistance = 0
                    }
                    if (Math.abs(moveXDistance) > rightWidth) {
                        moveXDistance = -rightWidth
                    }
                    isDrawRight = moveXDistance < 0
                    if (isDrawRight) {
                        warpper.style.left = -(currentSwiperItemIndex + 0) * width + moveXDistance + 'px'
                    } else {
                        warpper.style.left = -(currentSwiperItemIndex + 0) * width + moveXDistance + 'px'
                    }
                }
                if (currentSwiperItemIndex === 1) {
                    if (moveXDistance < 0) {
                        moveXDistance = 0
                    }
                    isDrawRight = moveXDistance < 0
                    if (isDrawRight) {
                        warpper.style.left = -(currentSwiperItemIndex + 0) * rightWidth + moveXDistance + 'px'
                    } else {
                        warpper.style.left = -(currentSwiperItemIndex + 0) * rightWidth + moveXDistance + 'px'
                    }
                }
            } else {
                if (moveYDistance > 0) {
                    console.log('往下划')
                    header.style.height = headerHeight + moveYDistance / 5 + 'px'
                } else {
                    console.log('往上划')
                }
                // console.log('y', moveYDistance)
            }
        })
        warpper.addEventListener('touchend', function (e) {
            //点击的是左边，并且是菜单展开状态，并且移动距离等于 0，那么就收起来
            let left = getCss(warpper, 'left')
            if (e.path.includes(leftEl) && left !== 0 && moveXDistance === 0) {
                warpper.style.transition = 'all .3s'
                warpper.style.left = 0
                leftEl.style.opacity = 1
                resetConfig()
                e.stopImmediatePropagation()
                e.stopPropagation()
                return false
            }
            if (isCanRightWiping) {
                if (!moveXDistance) return
                warpper.style.transition = 'all .3s'
                let endTime = Date.now()
                let gapTime = endTime - startTime

                // 如果
                if (Math.abs(moveXDistance) < 20) {
                    gapTime = 1000
                }
                if (Math.abs(moveXDistance) > (width / 3)) {
                    gapTime = 100
                }
                // console.log('是否向左划',isDrawRight)
                if (gapTime < 150) {
                    // console.log('小于500', currentIndex)
                    if (isDrawRight) {
                        // console.log('往左划');
                        warpper.style.left = -rightWidth + 'px'
                        leftEl.style.opacity = 0.5
                    } else {
                        warpper.style.left = 0
                        leftEl.style.opacity = 1
                    }
                } else {
                    if (currentSwiperItemIndex === 1) {
                        warpper.style.left = -rightWidth + 'px'
                    } else {
                        warpper.style.left = 0
                    }
                }
                resetConfig()
                isNeedCheck = true
                return
            } else {
                header.style.transition = 'all .3s'
                header.style.height = headerHeight + 'px'
                resetConfig()
            }
        })

        leftEl.addEventListener('scroll', function () {
            if (leftEl.scrollTop > indicatorCtnOffsetTop) {
                indicatorCtn.classList.add('fixed')
            } else {
                indicatorCtn.classList.remove('fixed')
            }
        })

        function resetConfig() {
            isCanDownWiping = false
            isCanRightWiping = false
            isNeedCheck = true
            moveXDistance = 0
            moveYDistance = 0
        }
        function checkDirection() {
            if (!isNeedCheck) {
                // console.log('不需要检测了')
                return
            }

            if (Math.abs(moveXDistance) > judgeValue || Math.abs(moveYDistance) > judgeValue) {
                //X 除以 Y
                let angle = (Math.abs(moveXDistance) * 10) / (Math.abs(moveYDistance) * 10)
                if (angle > 0.7 && angle < 1.3) {
                    isNeedCheck = false
                    return
                }

                // console.log('x------------', moveXDistance)
                // console.log('y------------', moveYDistance)
                // console.log('角度------------', angle)

                if (angle < 0.6) {
                    //上下划 
                    isCanRightWiping = false
                    isNeedCheck = false
                    return
                }
                if (angle > 5) {
                    //左右划 
                    isCanRightWiping = true
                    isNeedCheck = false
                    return
                }
            }
        }
    }()

    function getCss(curEle, attr) {
        var val = null, reg = null;
        if ("getComputedStyle" in window) {
            val = window.getComputedStyle(curEle, null)[attr];
        } else {   //ie6~8不支持上面属性  
            //不兼容  
            if (attr === "opacity") {
                val = curEle.currentStyle["filter"];   //'alpha(opacity=12,345)'  
                reg = /^alphaopacity=(\d+(?:\.\d+)?)opacity=(\d+(?:\.\d+)?)$/i;
                val = reg.test(val) ? reg.exec(val)[1] / 100 : 1;
            } else {
                val = curEle.currentStyle[attr];
            }
        }
        reg = /^(-?\d+(\.\d)?)(px|pt|em|rem)?$/i;
        return reg.test(val) ? parseFloat(val) : val;
    }
</script>
<script>
    !function () {
        let tabsCtn = document.querySelector('.tabs-ctn')
        let tabs = document.querySelector('.tabs')
        let indicator = document.querySelector('.indicator')
        let tabsTextCtn = document.querySelector('.tabs-text-ctn')

        let startLocationX = 0
        let startLocationY = 0

        let lastLocationX = 0

        let moveXDistance = 0
        let moveYDistance = 0

        let judgeValue = 20

        let startTime
        let currentSwiperItemIndex
        let isDrawRight

        let isCanRightWiping = false
        let isNeedCheck = true

        let width = document.body.clientWidth

        tabs.addEventListener('touchstart', function (e) {
            tabs.style.transition = 'none'
            indicator.style.transition = 'none'

            let left = getCss(tabs, 'left')
            if (Math.abs(left) === 0) {
                currentSwiperItemIndex = 0
            } else if (Math.abs(left) === width) {
                currentSwiperItemIndex = 1
            } else {
                currentSwiperItemIndex = 2
            }
            startLocationX = e.touches[0].pageX
            startLocationY = e.touches[0].pageY
            startTime = Date.now()
        })
        tabs.addEventListener('touchmove', function (e) {
            lastLocationX = e.touches[0].pageX
            lastLocationY = e.touches[0].pageY
            moveXDistance = lastLocationX - startLocationX
            moveYDistance = lastLocationY - startLocationY

            isDrawRight = moveXDistance < 0

            checkDirection()
            if (isCanRightWiping) {
                if (currentSwiperItemIndex === tabs.children.length - 1 && isDrawRight) {
                    return
                }
                e.stopImmediatePropagation();
                e.stopPropagation()
                if (isDrawRight) {
                    indicator.style.marginLeft = (1.5 + (currentSwiperItemIndex + 0) * 33 + Math.abs(moveXDistance) / width / 3 * 100) + '%'
                    tabs.style.left = -(currentSwiperItemIndex + 0) * width + moveXDistance + 'px'
                } else {
                    let marginLeft = (1.5 + (currentSwiperItemIndex + 0) * 33 - Math.abs(moveXDistance) / width / 3 * 100)
                    if (marginLeft > 1.5) {
                        indicator.style.marginLeft = marginLeft + '%'
                    } else {
                        indicator.style.marginLeft = '1.5%'
                    }
                    tabs.style.left = -(currentSwiperItemIndex + 0) * width + moveXDistance + 'px'
                }
            }
        })
        tabs.addEventListener('touchend', function (e) {
            if (isCanRightWiping) {
                if (currentSwiperItemIndex === tabs.children.length - 1 && isDrawRight) {
                    return
                }
                e.stopImmediatePropagation();
                e.stopPropagation()
                if (!moveXDistance) return
                tabs.style.transition = 'all .3s'
                indicator.style.transition = 'all .3s'

                let endTime = Date.now()
                let gapTime = endTime - startTime

                // 如果
                if (Math.abs(moveXDistance) < 20) {
                    gapTime = 1000
                }
                if (Math.abs(moveXDistance) > (width / 3)) {
                    gapTime = 100
                }

                if (gapTime < 150) {
                    // console.log('小于500', currentIndex)
                    if (isDrawRight) {
                        indicator.style.marginLeft = 1.5 + (currentSwiperItemIndex + 1) * 33 + '%'
                        console.log('往左划');
                        if (currentSwiperItemIndex === tabs.children.length - 1) {
                            tabs.style.left = -(tabs.children.length - 1) * width + 'px'
                            return
                        }
                        for (let item of tabsTextCtn.children) {
                            item.classList.remove('active')
                        }
                        tabsTextCtn.children[currentSwiperItemIndex + 1].classList.add('active')
                        tabs.style.left = -(currentSwiperItemIndex + 1) * width + 'px'
                        tabsCtn.style.height = getCss(tabs.children[currentSwiperItemIndex + 1], 'height') + 'px'

                    } else {

                        let marginLeft = 1.5 + (currentSwiperItemIndex - 1) * 33
                        if (marginLeft > 1.5) {
                            indicator.style.marginLeft = marginLeft + '%'
                        } else {
                            indicator.style.marginLeft = '1.5%'
                        }
                        console.log('往右划');
                        if (currentSwiperItemIndex === 0) {
                            return tabs.style.left = 0
                        }
                        for (let item of tabsTextCtn.children) {
                            item.classList.remove('active')
                        }
                        tabsTextCtn.children[currentSwiperItemIndex - 1].classList.add('active')
                        tabs.style.left = -(currentSwiperItemIndex - 1) * width + 'px'
                        tabsCtn.style.height = getCss(tabs.children[currentSwiperItemIndex - 1], 'height') + 'px'
                    }
                } else {
                    tabs.style.left = -(currentSwiperItemIndex) * width + 'px'
                }
            } else {
                isNeedCheck = true
            }
            resetConfig()
        })

        for (let textEl of tabsTextCtn.children) {
            textEl.addEventListener('click', function () {
                for (let item of tabsTextCtn.children) {
                    item.classList.remove('active')
                }
                textEl.classList.add('active')

                let tabsLeft = getCss(tabs, 'left')
                
                // console.log(Math.abs(tabsLeft)/width)
            })
        }
        function resetConfig() {
            isCanDownWiping = false
            isCanRightWiping = false
            isNeedCheck = true
            moveXDistance = 0
            moveYDistance = 0
        }
        function checkDirection() {
            if (!isNeedCheck) {
                // console.log('不需要检测了')
                return
            }

            if (Math.abs(moveXDistance) > judgeValue || Math.abs(moveYDistance) > judgeValue) {
                //X 除以 Y
                let angle = (Math.abs(moveXDistance) * 10) / (Math.abs(moveYDistance) * 10)
                // console.log(angle);
                if (angle > 0.7 && angle < 1.3) {
                    isNeedCheck = false
                    return
                }

                // console.log('x------------', moveXDistance)
                // console.log('y------------', moveYDistance)
                // console.log('角度------------', angle)

                if (angle < 0.6) {
                    //上下划
                    isCanDownWiping = true
                    isCanRightWiping = false
                    isNeedCheck = false
                    return
                }
                if (angle > 5) {
                    //左右划
                    isCanDownWiping = false
                    isCanRightWiping = true
                    isNeedCheck = false
                    return
                }
            }
        }
    }()
</script>
<script>

</script>

</html>